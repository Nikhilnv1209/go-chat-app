# Story: Inbox & Message History

**Feature ID**: F05
**Story IDs**: S05.01 (Conversation List), S05.02 (Message History)
**Epic**: E01 - MVP
**Status**: DONE
**Owner**: Developer Agent
**Test Cases**: 9 comprehensive automated tests - ALL PASSING âœ…

---

## User Story
**As a** user,
**I want to** see my past conversations and messages,
**So that** I don't lose context when I restart the app.

---

## Requirements Covered
- [R08] Inbox sorted by last_message_at.

---

## Technical Context
*   `Conversation` table is our inbox.
*   Read-side APIs are REST (not WebSocket).

---

## Files to Create/Modify
| File | Action |
|------|--------|
| `internal/repository/conversation_repo.go` | CREATE |
| `internal/handlers/chat_handler.go` | CREATE - Inbox & History endpoints |

---

## API Contracts

### GET /conversations
**Headers**: `Authorization: Bearer <token>`
**Response (200)**:
```json
[
  {
    "id": 101,
    "type": "DM",
    "target_id": 2,
    "target_name": "Bob",
    "last_message_at": "2023-10-27T10:00:00Z",
    "unread_count": 3
  },
  {
    "id": 102,
    "type": "GROUP",
    "target_id": 5,
    "target_name": "Family",
    "last_message_at": "2023-10-26T09:00:00Z",
    "unread_count": 0
  }
]
```

### GET /messages?target_id=2&type=DM
**Headers**: `Authorization: Bearer <token>`
**Query Params**:
*   `target_id`: User ID (for DM) or Group ID.
*   `type`: `DM` or `GROUP`.
*   `limit`: (optional) Default 50.
*   `before_id`: (optional) For pagination.

**Response (200)**:
```json
[
  { "id": 500, "sender_id": 2, "content": "Hello", "created_at": "..." },
  { "id": 499, "sender_id": 1, "content": "Hey Bob", "created_at": "..." }
]
```

---

## Acceptance Criteria
- [x] **AC1**: Returns correct list of DMs and Groups sorted by `last_message_at`.
- [x] **AC2**: History loads in reverse chronological order.
- [x] **AC3**: Pagination works (using `limit` - `before_id` deferred due to UUIDs).
