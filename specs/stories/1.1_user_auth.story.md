# Story: User Authentication System

**Feature ID**: F01
**Story IDs**: S01.01 (Register), S01.02 (Login)
**Epic**: E01 - MVP
**Status**: DONE
**Owner**: Developer Agent
**Test Cases**: T01.01, T01.02, T01.03, T01.04

---

## User Story
**As a** new user,
**I want to** register and login with a secure password,
**So that** I can access the chat features.

---

## Requirements Covered
- [R01] Users must register with unique email.
- [R02] Passwords must be hashed (bcrypt).
- [R03] JWT tokens expire in 24h.

---

## Technical Context
*   **Database Table**: `users`
*   **Password Hashing**: bcrypt (cost factor 10)
*   **Token**: JWT with 24h expiry, signed with `JWT_SECRET` env var.

---

## Files to Create/Modify
| File | Action |
|------|--------|
| `internal/models/user.go` | CREATE - User struct |
| `internal/repository/user_repo.go` | CREATE - DB operations |
| `internal/service/auth_service.go` | CREATE - Hash/Verify logic |
| `internal/handlers/auth_handler.go` | CREATE - HTTP endpoints |
| `pkg/jwt/jwt.go` | CREATE - Token generation |

---

## API Contracts

### POST /auth/register
**Request**:
```json
{ "username": "nikhil", "email": "n@e.com", "password": "secure123" }
```
**Success (201)**:
```json
{ "id": 1, "username": "nikhil", "email": "n@e.com" }
```
**Error (409)**:
```json
{ "error": "email already exists" }
```

### POST /auth/login
**Request**:
```json
{ "email": "n@e.com", "password": "secure123" }
```
**Success (200)**:
```json
{ "token": "eyJ...", "user": { "id": 1, "username": "nikhil" } }
```
**Error (401)**:
```json
{ "error": "invalid credentials" }
```

---

## Acceptance Criteria
- [x] **AC1** [T01.01]: Empty email returns 400 Bad Request.
- [x] **AC2** [T01.02]: Duplicate email returns 409 Conflict.
- [x] **AC3** [T01.03]: Valid login returns JWT.
- [x] **AC4** [T01.04]: Wrong password returns 401 Unauthorized.
